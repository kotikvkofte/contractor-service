# Contractor Service
## Описание
Микросервис для работы с контрагентами в финтех-приложении. Сервис предоставляет REST API для управления данными контрагентов и связанными справочниками (страны, отрасли, организационные формы).

## Технологии
- Java 21

- Spring Boot 3+

- PostgreSQL 16+

- Spring Data JDBC

- JdbcTemplate

- Liquibase (для миграций БД)

- Log4j2 (для логирования)

- Testcontainers (для интеграционных тестов)

Для обеспечения надёжного обмена данными с другими сервисами реализован **паттерн Outbox**:
- все события (например, обновление контрагента) сначала сохраняются в таблицу `outbox_event` в локальной БД;
- отдельный планировщик периодически читает события из таблицы и публикует их в RabbitMQ;
- после успешной отправки событие помечается как опубликованное.

Это гарантирует, что даже при сбое приложения данные не потеряются и будут доставлены другим сервисам (например, `Deal Service`).

## Архитектурные особенности
- Используется **RabbitMQ** для обмена сообщениями между сервисами.
- Сообщения публикуются в `contractors_contractor_exchange` с routing key `contractor.updated`.
- В сообщениях указывается заголовок `messageId` (уникальный идентификатор события).
- Сервис `Deal Service` подписан на очередь `deals_contractor_queue` и получает обновления контрагентов.
- Для обработки ошибок и повторных попыток доставки применяется политика Dead Letter Queue (DLQ).

## Схема обмена сообщениями
1. **Contractor Service** сохраняет событие в `outbox_event`.
2. Планировщик (`OutboxPublisher`) читает событие и отправляет его в RabbitMQ.
3. **Deal Service** принимает сообщение и обновляет данные в своей БД.
4. Если обработка невозможна, сообщение попадает в `deals_dead_contractor_queue` и через 5 минут возвращается в рабочую очередь для повторной попытки.


## Запуск приложения
1. Запуск через Docker Compose

   `docker-compose up -d`
   
2. Сервис будет доступен по адресу: http://localhost:8080